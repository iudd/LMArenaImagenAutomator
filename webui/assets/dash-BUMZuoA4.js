import{u as R}from"./system-CD4DQKFk.js";import{c as a,I as O,r as j,o as W,a as Y,b as _,d as b,w as s,e as d,f as i,g as p,u as c,t as m,h as Z,i as z,E as K,C as tt,j as et}from"./index-CdkAYAR1.js";var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 512.3v-.3c0-229.8-186.2-416-416-416S96 282.2 96 512v.4c0 229.8 186.2 416 416 416s416-186.2 416-416v-.3.2zm-6.7-74.6l.6 3.3-.6-3.3zM676.7 638.2c53.5-82.2 52.5-189.4-11.1-263.7l162.4-8.4c20.5 44.4 32 93.8 32 145.9 0 185.2-144.6 336.6-327.1 347.4l143.8-221.2zM512 652.3c-77.5 0-140.2-62.7-140.2-140.2 0-77.7 62.7-140.2 140.2-140.2S652.2 434.5 652.2 512 589.5 652.3 512 652.3zm369.2-331.7l-3-5.7 3 5.7zM512 164c121.3 0 228.2 62.1 290.4 156.2l-263.6-13.9c-97.5-5.7-190.2 49.2-222.3 141.1L227.8 311c63.1-88.9 166.9-147 284.2-147zM102.5 585.8c26 145 127.1 264 261.6 315.1C229.6 850 128.5 731 102.5 585.8zM164 512c0-55.9 13.2-108.7 36.6-155.5l119.7 235.4c44.1 86.7 137.4 139.7 234 121.6l-74 145.1C302.9 842.5 164 693.5 164 512zm324.7 415.4c4 .2 8 .4 12 .5-4-.2-8-.3-12-.5z"}}]},name:"chrome",theme:"outlined"};function N(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){rt(n,l,e[l])})}return n}function rt(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var C=function(t,e){var r=N({},t,e.attrs);return a(O,N({},r,{icon:nt}),null)};C.displayName="ChromeOutlined";C.inheritAttrs=!1;var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"};function U(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){lt(n,l,e[l])})}return n}function lt(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var M=function(t,e){var r=U({},t,e.attrs);return a(O,U({},r,{icon:at}),null)};M.displayName="DesktopOutlined";M.inheritAttrs=!1;var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c.1-6.2-5-11.2-11.1-11.2z"}},{tag:"path",attrs:{d:"M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7a321 321 0 01-44.5 55.7 317.17 317.17 0 01-101.3 68.3c-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3a321 321 0 0144.5 55.7c3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8a9.18 9.18 0 00-8.2-13.3z"}}]},name:"field-time",theme:"outlined"};function L(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){st(n,l,e[l])})}return n}function st(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var $=function(t,e){var r=L({},t,e.attrs);return a(O,L({},r,{icon:ot}),null)};$.displayName="FieldTimeOutlined";$.inheritAttrs=!1;var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"};function E(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){it(n,l,e[l])})}return n}function it(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var D=function(t,e){var r=E({},t,e.attrs);return a(O,E({},r,{icon:ct}),null)};D.displayName="LineChartOutlined";D.inheritAttrs=!1;var ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"};function F(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){ft(n,l,e[l])})}return n}function ft(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var V=function(t,e){var r=F({},t,e.attrs);return a(O,F({},r,{icon:ut}),null)};V.displayName="PieChartOutlined";V.inheritAttrs=!1;var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function T(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},r=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable}))),r.forEach(function(l){pt(n,l,e[l])})}return n}function pt(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var x=function(t,e){var r=T({},t,e.attrs);return a(O,T({},r,{icon:dt}),null)};x.displayName="SyncOutlined";x.inheritAttrs=!1;const mt={style:{display:"flex","justify-content":"space-between"}},gt={style:{display:"flex","justify-content":"space-between"}},vt={style:{display:"flex","justify-content":"space-between"}},yt={style:{display:"flex","justify-content":"space-between","margin-bottom":"4px"}},ht={style:{display:"flex","justify-content":"space-between","margin-bottom":"4px"}},bt={style:{"font-size":"14px",color:"#8c8c8c"}},Ot={style:{"font-size":"14px",color:"#8c8c8c"}},_t={style:{color:"#8c8c8c","font-size":"12px"}},wt={style:{"font-weight":"500","margin-right":"8px"}},xt={key:0,style:{"text-align":"center",padding:"24px",color:"#8c8c8c"}},jt={__name:"dash",setup(n){const t=R(),e=j([]),r=j(null),l=j({processing:0,waiting:0,total:0}),I=async()=>{const u=et();try{const o=await fetch("/admin/queue",{headers:u.getHeaders()});if(o.ok){const f=await o.json();l.value={processing:f.processing||0,waiting:f.waiting||0,total:f.total||0};const g=(f.processingTasks||[]).map(v=>({...v,status:"processing"})),S=(f.waitingTasks||[]).map(v=>({...v,status:"waiting"}));e.value=[...g,...S]}}catch(o){console.error("Fetch queue failed",o)}},k=async()=>{await Promise.all([t.fetchStatus(),t.fetchStats(),I()])},q=u=>{const o=Math.floor(u/86400),f=Math.floor(u%(3600*24)/3600),g=Math.floor(u%3600/60);return o>0?`${o}天 ${f}小时 ${g}分`:f>0?`${f}小时 ${g}分`:`${g}分`},A=u=>!u||u===0?"0 MB":u>1024?parseFloat((u/1024).toFixed(2))+" GB":parseFloat(Number(u).toFixed(2))+" MB",B=u=>u<50?"#52c41a":u<80?"#faad14":"#f5222d",H=u=>({normal:{color:"green",text:"正常模式 (Normal)"},headless:{color:"blue",text:"无头模式 (Headless)"},xvfb:{color:"purple",text:"虚拟显示 (Xvfb)"}})[u]||{color:"red",text:"未运行"};return W(()=>{k(),r.value=setInterval(k,5e3)}),Y(()=>{r.value&&clearInterval(r.value)}),(u,o)=>{const f=d("a-tag"),g=d("a-progress"),S=d("a-space"),v=d("a-card"),h=d("a-col"),w=d("a-statistic"),P=d("a-row"),G=d("a-list-item-meta"),Q=d("a-list-item"),X=d("a-list"),J=d("a-layout");return b(),_(J,{style:{width:"100%",background:"transparent"}},{default:s(()=>[a(P,{gutter:[16,16],style:{"margin-bottom":"24px"}},{default:s(()=>[a(h,{xs:24,md:12},{default:s(()=>[a(v,{title:"系统状态",bordered:!1,style:{height:"100%"}},{default:s(()=>[a(S,{direction:"vertical",style:{width:"100%"},size:"middle"},{default:s(()=>[i("div",mt,[i("span",null,[a(c(M)),o[0]||(o[0]=p(" 系统版本: ",-1))]),i("b",null,m(c(t).systemVersion),1)]),i("div",gt,[i("span",null,[a(c($)),o[1]||(o[1]=p(" 运行时间: ",-1))]),i("b",null,m(q(c(t).uptime)),1)]),i("div",vt,[i("span",null,[a(c(C)),o[2]||(o[2]=p(" 状态: ",-1))]),a(f,{color:H(c(t).status).color},{default:s(()=>[p(m(H(c(t).status).text),1)]),_:1},8,["color"])]),i("div",null,[i("div",yt,[i("span",null,[a(c(D)),o[3]||(o[3]=p(" CPU 使用率: ",-1))]),i("span",null,m(c(t).cpuUsage)+"%",1)]),a(g,{percent:c(t).cpuUsage,"stroke-color":B(c(t).cpuUsage),"show-info":!1},null,8,["percent","stroke-color"])]),i("div",null,[i("div",ht,[i("span",null,[a(c(V)),o[4]||(o[4]=p(" 内存使用: ",-1))]),i("span",null,m(A(c(t).memoryUsage.used))+" / "+m(A(c(t).memoryUsage.total)),1)]),a(g,{percent:Math.round(c(t).memoryUsage.used/c(t).memoryUsage.total*100)||0,"stroke-color":B(c(t).memoryUsage.used/c(t).memoryUsage.total*100),"show-info":!1},null,8,["percent","stroke-color"])])]),_:1})]),_:1})]),_:1}),a(h,{xs:24,md:12},{default:s(()=>[a(v,{title:"业务统计",bordered:!1,style:{height:"100%"}},{default:s(()=>[a(P,{gutter:16,style:{"margin-bottom":"24px"}},{default:s(()=>[a(h,{span:12},{default:s(()=>[a(w,{title:"窗口数量",value:c(t).stats.workers||0},{suffix:s(()=>[...o[5]||(o[5]=[i("span",{style:{"font-size":"14px",color:"#8c8c8c"}},"个",-1)])]),_:1},8,["value"])]),_:1}),a(h,{span:12},{default:s(()=>[a(w,{title:"实例数量",value:c(t).stats.instances||0,'"':""},{suffix:s(()=>[...o[6]||(o[6]=[i("span",{style:{"font-size":"14px",color:"#8c8c8c"}},"个",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),a(P,{gutter:16},{default:s(()=>[a(h,{span:12},{default:s(()=>[a(w,{title:"正在进行",value:l.value.processing},{suffix:s(()=>[i("span",bt,"/ "+m(l.value.total),1)]),_:1},8,["value"])]),_:1}),a(h,{span:12},{default:s(()=>[a(w,{title:"等待排队",value:l.value.waiting},{suffix:s(()=>[i("span",Ot,"/ "+m(l.value.total),1)]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(v,{title:"任务队列实时监控",bordered:!1,style:{width:"100%"},bodyStyle:{padding:"0 24px"}},{extra:s(()=>[i("div",_t,[a(c(x),{spin:!0,style:{"margin-right":"4px"}}),o[7]||(o[7]=p(" 实时刷新中 ",-1))])]),default:s(()=>[a(X,{"item-layout":"horizontal","data-source":e.value},{renderItem:s(({item:y})=>[a(Q,null,{default:s(()=>[a(G,{description:`ID: ${y.id}`},{title:s(()=>[i("span",wt,m(y.model),1),y.worker?(b(),_(f,{key:0,color:"blue"},{default:s(()=>[p(m(y.worker),1)]),_:2},1024)):z("",!0)]),_:2},1032,["description"]),i("div",null,[y.status==="processing"?(b(),_(f,{key:0,color:"processing"},{icon:s(()=>[a(c(x),{spin:!0})]),default:s(()=>[o[8]||(o[8]=p(" 进行中 ",-1))]),_:1})):y.status==="waiting"?(b(),_(f,{key:1,color:"warning"},{icon:s(()=>[a(c(K))]),default:s(()=>[o[9]||(o[9]=p(" 等待中 ",-1))]),_:1})):y.status==="success"?(b(),_(f,{key:2,color:"success"},{icon:s(()=>[a(c(tt))]),default:s(()=>[o[10]||(o[10]=p(" 已完成 ",-1))]),_:1})):z("",!0)])]),_:2},1024)]),default:s(()=>[e.value.length===0?(b(),Z("div",xt," 暂无任务 ")):z("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1})}}};export{jt as default};
