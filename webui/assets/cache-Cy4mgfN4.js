import{u as Y}from"./system-CD4DQKFk.js";import{c as a,I as Z,j as K,r as y,n as h,b as tt,d as et,w as e,f as s,e as l,g as p,u as _,P as j,D as F,p as N,t as x,q as u,s as st,L as T,C as at}from"./index-CdkAYAR1.js";var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};function B(m){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?Object(arguments[o]):{},r=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(i).filter(function(g){return Object.getOwnPropertyDescriptor(i,g).enumerable}))),r.forEach(function(g){ot(m,g,i[g])})}return m}function ot(m,o,i){return o in m?Object.defineProperty(m,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):m[o]=i,m}var C=function(o,i){var r=B({},o,i.attrs);return a(Z,B({},r,{icon:nt}),null)};C.displayName="StopOutlined";C.inheritAttrs=!1;const lt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},it={style:{padding:"24px 0"}},rt={style:{flex:"1"}},ct={style:{display:"flex","align-items":"center","margin-bottom":"12px"}},dt={style:{flex:"1"}},ut={style:{display:"flex","align-items":"center","margin-bottom":"12px"}},ft={style:{"margin-bottom":"16px"}},pt={style:{"font-size":"12px","margin-top":"4px"}},mt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},vt={style:{"font-size":"12px",color:"#8c8c8c"}},gt={style:{"white-space":"nowrap"}},xt={__name:"cache",setup(m){const o=Y(),i=K(),r=y(0),g=y(!1),c=y([{title:"准备重启",status:"wait",icon:h(st)},{title:"发送指令",status:"wait",icon:h(j)},{title:"正在重启",status:"wait",icon:h(T)},{title:"等待服务恢复",status:"wait",icon:h(T)},{title:"完成",status:"wait",icon:h(at)}]),w=y(!1),d=y([]),z=y([]),b=y(!1),k=n=>new Promise(t=>setTimeout(t,n)),I=async()=>{b.value=!0,g.value=!0,r.value=0,c.value[0].status="process",await k(500),c.value[0].status="finish",r.value=1,c.value[1].status="process";try{await o.restartService(),c.value[1].status="finish",r.value=2}catch{c.value[1].status="error",u.error("无法连接到服务器");return}c.value[2].status="process",await k(5e3),c.value[2].status="finish",r.value=3,c.value[3].status="process";let n=20;for(;n>0;){try{if(await o.fetchStatus(),o.status==="running")break}catch{}await k(2e3),n--}c.value[3].status="finish",r.value=4,c.value[4].status="finish",u.success("服务重启成功"),setTimeout(()=>{b.value=!1,g.value=!1,c.value.forEach(t=>t.status="wait"),r.value=0},1500)},V=async()=>{try{await o.stopService()&&u.success("服务已停止")}catch(n){u.error("停止服务失败: "+n.message)}},H=async()=>{try{(await fetch("/admin/cache/clear",{method:"POST",headers:i.getHeaders()})).ok?u.success("缓存文件夹已清理"):u.error("清理失败")}catch(n){u.error("请求失败: "+n.message)}},P=async()=>{d.value=[],w.value=!0;try{const n=await fetch("/admin/data-folders",{headers:i.getHeaders()});n.ok&&(z.value=await n.json())}catch{u.error("获取文件夹列表失败")}},L=(n,t)=>{t?d.value.includes(n)||d.value.push(n):d.value=d.value.filter(v=>v!==n)},R=async()=>{if(d.value.length===0){u.warning("请先选择要删除的文件夹");return}try{(await fetch("/admin/data-folders/delete",{method:"POST",headers:i.getHeaders(),body:JSON.stringify({folders:d.value})})).ok?(u.success(`已删除 ${d.value.length} 个实例数据文件夹`),await P()):u.error("删除失败")}catch{u.error("删除请求失败")}};return(n,t)=>{const v=l("a-button"),S=l("a-popconfirm"),$=l("a-space"),O=l("a-card"),E=l("a-steps"),M=l("a-modal"),D=l("a-col"),U=l("a-row"),q=l("a-checkbox"),A=l("a-list-item-meta"),J=l("a-list-item"),G=l("a-list"),Q=l("a-drawer"),W=l("a-layout");return et(),tt(W,{style:{background:"transparent"}},{default:e(()=>[a(O,{title:"项目管理",bordered:!1,style:{width:"100%","margin-bottom":"10px"}},{default:e(()=>[s("div",lt,[t[6]||(t[6]=s("div",{style:{display:"flex","align-items":"center"}},[s("div",{style:{"margin-right":"16px"}},[s("div",{style:{"font-weight":"600","margin-bottom":"4px"}},"系统服务控制"),s("div",{style:{"font-size":"12px",color:"#8c8c8c"}}," 控制后端服务的运行状态 (重启或停止) ")])],-1)),s("div",null,[a($,null,{default:e(()=>[a(S,{title:"确定要重启服务吗？","ok-text":"确定","cancel-text":"取消",onConfirm:I},{default:e(()=>[a(v,{type:"primary",size:"large"},{icon:e(()=>[a(_(j))]),default:e(()=>[t[3]||(t[3]=p(" 重启 ",-1))]),_:1})]),_:1}),a(S,{"ok-text":"确定","cancel-text":"取消",onConfirm:V,placement:"topRight"},{title:e(()=>[...t[4]||(t[4]=[s("div",{style:{width:"240px"}},[s("div",{style:{"font-weight":"500","margin-bottom":"4px"}},"确定要停止服务吗？"),s("div",{style:{"font-size":"12px",color:"#f5222d"}},"停止后服务将完全终止，需要手动重新启动。")],-1)])]),default:e(()=>[a(v,{type:"primary",danger:"",size:"large"},{icon:e(()=>[a(_(C))]),default:e(()=>[t[5]||(t[5]=p(" 停止 ",-1))]),_:1})]),_:1})]),_:1})])])]),_:1}),a(M,{open:b.value,"onUpdate:open":t[0]||(t[0]=f=>b.value=f),title:"系统服务重启中",footer:null,closable:!1,maskClosable:!1,width:"500px"},{default:e(()=>[s("div",it,[a(E,{current:r.value,items:c.value},null,8,["current","items"]),t[7]||(t[7]=s("div",{style:{"text-align":"center","margin-top":"24px",color:"#8c8c8c"}}," 请稍候，系统正在执行重启操作... ",-1))])]),_:1},8,["open"]),a(O,{title:"缓存管理",bordered:!1,style:{width:"100%"}},{default:e(()=>[a(U,{gutter:[16,16]},{default:e(()=>[a(D,{xs:24,md:12},{default:e(()=>[a(O,{style:{height:"100%"},"body-style":{display:"flex",flexDirection:"column",height:"100%"}},{default:e(()=>[s("div",rt,[s("div",ct,[a(_(F),{style:{"font-size":"24px",color:"#1890ff","margin-right":"8px"}}),t[8]||(t[8]=s("div",{style:{"font-weight":"600","font-size":"16px"}},"清理缓存文件夹",-1))]),t[9]||(t[9]=s("div",{style:{"font-size":"12px",color:"#8c8c8c","margin-bottom":"16px"}},[p(" 清理项目运行过程中可能会遗留的临时缓存文件（如遇到错误时遗留的图片），"),s("br"),p(" 不会影响用户数据和配置"),s("strong",{style:{color:"#ff4d4f"}},"有任务运行时请勿执行")],-1))]),a(S,{title:"确定要清理缓存文件夹吗？","ok-text":"确定","cancel-text":"取消",onConfirm:H},{default:e(()=>[a(v,{type:"primary",block:""},{icon:e(()=>[a(_(F))]),default:e(()=>[t[10]||(t[10]=p(" 清理缓存 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{xs:24,md:12},{default:e(()=>[a(O,{style:{height:"100%"},"body-style":{display:"flex",flexDirection:"column",height:"100%"}},{default:e(()=>[s("div",dt,[s("div",ut,[a(_(N),{style:{"font-size":"24px",color:"#ff4d4f","margin-right":"8px"}}),t[11]||(t[11]=s("div",{style:{"font-weight":"600","font-size":"16px"}},"删除实例数据文件夹",-1))]),t[12]||(t[12]=s("div",{style:{"font-size":"12px",color:"#8c8c8c","margin-bottom":"16px"}},[p(" 删除所有浏览器实例的用户数据文件夹，"),s("br"),p(" 包括 Cookie、本地存储等，"),s("strong",{style:{color:"#ff4d4f"}},"请谨慎操作")],-1))]),a(v,{danger:"",block:"",onClick:P},{icon:e(()=>[a(_(N))]),default:e(()=>[t[13]||(t[13]=p(" 管理实例数据 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{open:w.value,"onUpdate:open":t[2]||(t[2]=f=>w.value=f),title:"管理实例数据文件夹",placement:"right",width:"500"},{footer:e(()=>[s("div",mt,[s("div",vt," 已选择 "+x(d.value.length)+" 个文件夹 ",1),s("div",null,[a(v,{style:{"margin-right":"8px"},onClick:t[1]||(t[1]=f=>w.value=!1)},{default:e(()=>[...t[15]||(t[15]=[p(" 取消 ",-1)])]),_:1}),a(S,{placement:"topRight","ok-text":"确定删除","cancel-text":"取消",onConfirm:R},{title:e(()=>[s("div",gt," 确定要删除选中的 "+x(d.value.length)+" 个文件夹吗？ ",1)]),default:e(()=>[a(v,{type:"primary",danger:"",disabled:d.value.length===0},{default:e(()=>[...t[16]||(t[16]=[p(" 删除选中项 ",-1)])]),_:1},8,["disabled"])]),_:1})])])]),default:e(()=>[s("div",ft,[t[14]||(t[14]=s("div",{style:{"font-size":"12px",color:"#8c8c8c","margin-bottom":"12px"}}," 选择要删除的实例数据文件夹，删除后无法恢复，请谨慎操作 ",-1)),a(G,{"data-source":z.value,bordered:""},{renderItem:e(({item:f})=>[a(J,null,{default:e(()=>[a(A,null,{title:e(()=>[a(q,{checked:d.value.includes(f.name),onChange:X=>L(f.name,X.target.checked)},{default:e(()=>[p(x(f.name),1)]),_:2},1032,["checked","onChange"])]),description:e(()=>[s("div",pt,[s("div",null,"路径: "+x(f.path),1),s("div",null,"关联实例: "+x(f.instance),1),s("div",null,"大小: "+x(f.size),1)])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])])]),_:1},8,["open"])]),_:1})}}};export{xt as default};
