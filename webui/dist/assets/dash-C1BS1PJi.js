import{u as X}from"./system-C2wy1aIP.js";import{c as r,I as O,r as z,o as J,a as R,b,d as h,w as o,e as d,f as c,g as p,u as i,t as m,h as W,i as C,E as Y,C as Z,j as K}from"./index-N039yHLa.js";import{D as tt}from"./DesktopOutlined-DmRiuvy2.js";var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 512.3v-.3c0-229.8-186.2-416-416-416S96 282.2 96 512v.4c0 229.8 186.2 416 416 416s416-186.2 416-416v-.3.2zm-6.7-74.6l.6 3.3-.6-3.3zM676.7 638.2c53.5-82.2 52.5-189.4-11.1-263.7l162.4-8.4c20.5 44.4 32 93.8 32 145.9 0 185.2-144.6 336.6-327.1 347.4l143.8-221.2zM512 652.3c-77.5 0-140.2-62.7-140.2-140.2 0-77.7 62.7-140.2 140.2-140.2S652.2 434.5 652.2 512 589.5 652.3 512 652.3zm369.2-331.7l-3-5.7 3 5.7zM512 164c121.3 0 228.2 62.1 290.4 156.2l-263.6-13.9c-97.5-5.7-190.2 49.2-222.3 141.1L227.8 311c63.1-88.9 166.9-147 284.2-147zM102.5 585.8c26 145 127.1 264 261.6 315.1C229.6 850 128.5 731 102.5 585.8zM164 512c0-55.9 13.2-108.7 36.6-155.5l119.7 235.4c44.1 86.7 137.4 139.7 234 121.6l-74 145.1C302.9 842.5 164 693.5 164 512zm324.7 415.4c4 .2 8 .4 12 .5-4-.2-8-.3-12-.5z"}}]},name:"chrome",theme:"outlined"};function N(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),a.forEach(function(s){nt(n,s,e[s])})}return n}function nt(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var j=function(t,e){var a=N({},t,e.attrs);return r(O,N({},a,{icon:et}),null)};j.displayName="ChromeOutlined";j.inheritAttrs=!1;var rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c.1-6.2-5-11.2-11.1-11.2z"}},{tag:"path",attrs:{d:"M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7a321 321 0 01-44.5 55.7 317.17 317.17 0 01-101.3 68.3c-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3a321 321 0 0144.5 55.7c3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8a9.18 9.18 0 00-8.2-13.3z"}}]},name:"field-time",theme:"outlined"};function V(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),a.forEach(function(s){at(n,s,e[s])})}return n}function at(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var M=function(t,e){var a=V({},t,e.attrs);return r(O,V({},a,{icon:rt}),null)};M.displayName="FieldTimeOutlined";M.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"};function L(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),a.forEach(function(s){ot(n,s,e[s])})}return n}function ot(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var $=function(t,e){var a=L({},t,e.attrs);return r(O,L({},a,{icon:lt}),null)};$.displayName="LineChartOutlined";$.inheritAttrs=!1;var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"};function F(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),a.forEach(function(s){it(n,s,e[s])})}return n}function it(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var A=function(t,e){var a=F({},t,e.attrs);return r(O,F({},a,{icon:st}),null)};A.displayName="PieChartOutlined";A.inheritAttrs=!1;var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function E(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),a.forEach(function(s){ut(n,s,e[s])})}return n}function ut(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var x=function(t,e){var a=E({},t,e.attrs);return r(O,E({},a,{icon:ct}),null)};x.displayName="SyncOutlined";x.inheritAttrs=!1;const ft={style:{display:"flex","justify-content":"space-between"}},dt={style:{display:"flex","justify-content":"space-between"}},pt={style:{display:"flex","justify-content":"space-between"}},mt={style:{display:"flex","justify-content":"space-between","margin-bottom":"4px"}},gt={style:{display:"flex","justify-content":"space-between","margin-bottom":"4px"}},vt={style:{"font-size":"14px",color:"#8c8c8c"}},yt={style:{"font-size":"14px",color:"#8c8c8c"}},_t={style:{color:"#8c8c8c","font-size":"12px"}},ht={style:{"font-weight":"500","margin-right":"8px"}},bt={key:0,style:{"text-align":"center",padding:"24px",color:"#8c8c8c"}},St={__name:"dash",setup(n){const t=X(),e=z([]),a=z(null),s=z({processing:0,waiting:0,total:0}),H=async()=>{const u=K();try{const l=await fetch("/admin/queue",{headers:u.getHeaders()});if(l.ok){const f=await l.json();s.value={processing:f.processing||0,waiting:f.waiting||0,total:f.total||0};const g=(f.processingTasks||[]).map(v=>({...v,status:"processing"})),S=(f.waitingTasks||[]).map(v=>({...v,status:"waiting"}));e.value=[...g,...S]}}catch(l){console.error("Fetch queue failed",l)}},B=async()=>{await Promise.all([t.fetchStatus(),t.fetchStats(),H()])},T=u=>{const l=Math.floor(u/86400),f=Math.floor(u%(3600*24)/3600),g=Math.floor(u%3600/60);return l>0?`${l}天 ${f}小时 ${g}分`:f>0?`${f}小时 ${g}分`:`${g}分`},U=u=>!u||u===0?"0 MB":u>1024?parseFloat((u/1024).toFixed(2))+" GB":parseFloat(Number(u).toFixed(2))+" MB",k=u=>u<50?"#52c41a":u<80?"#faad14":"#f5222d",D=u=>({normal:{color:"green",text:"正常模式 (Normal)"},headless:{color:"blue",text:"无头模式 (Headless)"},xvfb:{color:"purple",text:"虚拟显示 (Xvfb)"}})[u]||{color:"red",text:"未运行"};return J(()=>{B(),a.value=setInterval(B,5e3)}),R(()=>{a.value&&clearInterval(a.value)}),(u,l)=>{const f=d("a-tag"),g=d("a-progress"),S=d("a-space"),v=d("a-card"),_=d("a-col"),w=d("a-statistic"),P=d("a-row"),I=d("a-list-item-meta"),q=d("a-list-item"),G=d("a-list"),Q=d("a-layout");return h(),b(Q,{style:{width:"100%",background:"transparent"}},{default:o(()=>[r(P,{gutter:[16,16],style:{"margin-bottom":"24px"}},{default:o(()=>[r(_,{xs:24,md:12},{default:o(()=>[r(v,{title:"系统状态",bordered:!1,style:{height:"100%"}},{default:o(()=>[r(S,{direction:"vertical",style:{width:"100%"},size:"middle"},{default:o(()=>[c("div",ft,[c("span",null,[r(i(tt)),l[0]||(l[0]=p(" 系统版本: ",-1))]),c("b",null,m(i(t).systemVersion),1)]),c("div",dt,[c("span",null,[r(i(M)),l[1]||(l[1]=p(" 运行时间: ",-1))]),c("b",null,m(T(i(t).uptime)),1)]),c("div",pt,[c("span",null,[r(i(j)),l[2]||(l[2]=p(" 状态: ",-1))]),r(f,{color:D(i(t).status).color},{default:o(()=>[p(m(D(i(t).status).text),1)]),_:1},8,["color"])]),c("div",null,[c("div",mt,[c("span",null,[r(i($)),l[3]||(l[3]=p(" CPU 使用率: ",-1))]),c("span",null,m(i(t).cpuUsage)+"%",1)]),r(g,{percent:i(t).cpuUsage,"stroke-color":k(i(t).cpuUsage),"show-info":!1},null,8,["percent","stroke-color"])]),c("div",null,[c("div",gt,[c("span",null,[r(i(A)),l[4]||(l[4]=p(" 内存使用: ",-1))]),c("span",null,m(U(i(t).memoryUsage.used))+" / "+m(U(i(t).memoryUsage.total)),1)]),r(g,{percent:Math.round(i(t).memoryUsage.used/i(t).memoryUsage.total*100)||0,"stroke-color":k(i(t).memoryUsage.used/i(t).memoryUsage.total*100),"show-info":!1},null,8,["percent","stroke-color"])])]),_:1})]),_:1})]),_:1}),r(_,{xs:24,md:12},{default:o(()=>[r(v,{title:"业务统计",bordered:!1,style:{height:"100%"}},{default:o(()=>[r(P,{gutter:16,style:{"margin-bottom":"24px"}},{default:o(()=>[r(_,{span:12},{default:o(()=>[r(w,{title:"窗口数量",value:i(t).stats.workers||0},{suffix:o(()=>[...l[5]||(l[5]=[c("span",{style:{"font-size":"14px",color:"#8c8c8c"}},"个",-1)])]),_:1},8,["value"])]),_:1}),r(_,{span:12},{default:o(()=>[r(w,{title:"实例数量",value:i(t).stats.instances||0},{suffix:o(()=>[...l[6]||(l[6]=[c("span",{style:{"font-size":"14px",color:"#8c8c8c"}},"个",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),r(P,{gutter:16},{default:o(()=>[r(_,{span:12},{default:o(()=>[r(w,{title:"正在进行",value:s.value.processing},{suffix:o(()=>[c("span",vt,"/ "+m(s.value.total),1)]),_:1},8,["value"])]),_:1}),r(_,{span:12},{default:o(()=>[r(w,{title:"等待排队",value:s.value.waiting},{suffix:o(()=>[c("span",yt,"/ "+m(s.value.total),1)]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(v,{title:"任务队列实时监控",bordered:!1,style:{width:"100%"},bodyStyle:{padding:"0 24px"}},{extra:o(()=>[c("div",_t,[r(i(x),{spin:!0,style:{"margin-right":"4px"}}),l[7]||(l[7]=p(" 实时刷新中 ",-1))])]),default:o(()=>[r(G,{"item-layout":"horizontal","data-source":e.value},{renderItem:o(({item:y})=>[r(q,null,{default:o(()=>[r(I,{description:`ID: ${y.id}`},{title:o(()=>[c("span",ht,m(y.model),1),y.worker?(h(),b(f,{key:0,color:"blue"},{default:o(()=>[p(m(y.worker),1)]),_:2},1024)):C("",!0)]),_:2},1032,["description"]),c("div",null,[y.status==="processing"?(h(),b(f,{key:0,color:"processing"},{icon:o(()=>[r(i(x),{spin:!0})]),default:o(()=>[l[8]||(l[8]=p(" 进行中 ",-1))]),_:1})):y.status==="waiting"?(h(),b(f,{key:1,color:"warning"},{icon:o(()=>[r(i(Y))]),default:o(()=>[l[9]||(l[9]=p(" 等待中 ",-1))]),_:1})):y.status==="success"?(h(),b(f,{key:2,color:"success"},{icon:o(()=>[r(i(Z))]),default:o(()=>[l[10]||(l[10]=p(" 已完成 ",-1))]),_:1})):C("",!0)])]),_:2},1024)]),default:o(()=>[e.value.length===0?(h(),W("div",bt," 暂无任务 ")):C("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1})}}};export{St as default};
